
CREATE TABLE TAB_FATURAMENTO
(DATA_VENDA DATE NULL,
TOTAL_VENDA FLOAT);

SELECT * FROM TAB_FATURAMENTO;
SELECT * FROM NOTAS;
SELECT * FROM itens_notas;

INSERT INTO NOTAS (NUMERO,DATA_VENDA,CPF,MATRICULA,IMPOSTO)
VALUES(0100,'2019-05-08','1471156710','235',0.10);


INSERT INTO ITENS_NOTAS(NUMERO,CODIGO,QUANTIDADE,PRECO)
VALUES('100', '1000889', 100, 10);
INSERT INTO ITENS_NOTAS(NUMERO,CODIGO,QUANTIDADE,PRECO)
VALUES ('101', '1002334', 100, 10);

INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ('0101', '2019-05-08', '1471156710' , '235', 0.10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('0101', '1000889', 100, 10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('0101', '1002334', 100, 10);
INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ('0103', '2019-05-08', '1471156710' , '235', 0.10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('0103', '1000889', 100, 10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('0103', '1002334', 100, 10);


/*JUNTANDO TABELAS*/

SELECT A.DATA_VENDA, SUM(B.QUANTIDADE*B.PRECO) AS TOTAL_VENDA FROM 
NOTAS A INNER JOIN ITENS_NOTAS B
ON A.NUMERO = B.NUMERO
GROUP BY A.DATA_VENDA;

/*TRIGGER*/
DELIMITER //
CREATE TRIGGER TG_CALCULA_FATURAMENTO_INSERT AFTER INSERT ON itens_notas
FOR EACH ROW BEGIN
  DELETE FROM TAB_FATURAMENTO;
  INSERT INTO TAB_FATURAMENTO
  SELECT A.DATA_VENDA, SUM(B.QUANTIDADE * B.PRECO) AS TOTAL_VENDA FROM
  NOTAS A INNER JOIN ITENS_NOTAS B
  ON A.NUMERO = B.NUMERO
  GROUP BY A.DATA_VENDA;
END //


INSERT INTO NOTAS (NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ('0106', '2019-05-08', '1471156710' , '235', 0.10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('0106', '1000889', 100, 10);
INSERT INTO ITENS_NOTAS (NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('0103', '1002334', 100, 10);

SELECT * FROM TAB_FATURAMENTO;

/*VISUALIZANDO*/
SELECT * FROM itens_notas;
SELECT * FROM NOTAS;
SELECT * FROM TAB_FATURAMENTO;

DELETE FROM NOTAS;